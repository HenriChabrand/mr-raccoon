function getResult(callback, json) { var token = 'AIzaSyDLGejsdWAYT5BKgqqvmRQUoWtT34OWfE8'; console.log('call_id : api_4_call_1'); var input = json.input; var all_required = false; if(input.geoCode.lat&&input.geoCode.lng){ all_required = true; } if(all_required){ var call = 'https://maps.googleapis.com/maps/api/geocode/json?latlng='+input.geoCode.lat+','+input.geoCode.lng+'&key='+token+''; require('request')(call, function (error, response, body) { if (!error && response.statusCode == 200) { var info = JSON.parse(body); json.input.adress = info.results[0].formatted_address; json.index = json.index+1; if(json.step[json.index].nb=='end'){ callback(json.input[json.query]); }else{ var action_module = require('./'+ json.step[json.index].call_id + '.js'); action_module.getResult(function(result) { callback(result); },json); } }else{ callback('the request failed'); } }); } } exports.getResult = getResult;
